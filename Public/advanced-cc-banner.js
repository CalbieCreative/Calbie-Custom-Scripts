document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector('[data-calbie-cc="banner"]'),o=document.querySelector('[data-calbie-cc="preferences-popup"]'),c=document.querySelector('[data-calbie-cc="accept"]'),t=document.querySelector('[data-calbie-cc="decline"]'),n=document.querySelector('[data-calbie-cc="manage-preferences"]'),a=document.querySelector('[data-calbie-cc="save-preferences"]'),l=document.querySelector('[data-calbie-cc="close-preferences"]'),i=document.querySelector('[data-calbie-cc="open-settings"]'),s=document.querySelector('[data-calbie-cc-category="analytics"]'),r=document.querySelector('[data-calbie-cc-category="marketing"]'),d=document.querySelector('[data-calbie-cc-category="functional"]');if(!e)return void console.error('C.C. banner element not found. Please add data-calbie-cc="banner" attribute to your banner div.');if(!c||!t)return void console.error("C.C. buttons not found. Please check your data-calbie-cc attributes.");const g="calbie_cookie_consent_preferences",u={status:"pending",categories:{essential:!0,analytics:!1,marketing:!1,functional:!1}};function m(){const e={googleAnalytics:!1,googleTagManager:!1,metaPixel:!1,googleMaps:!1,otherAnalytics:[],otherMarketing:[]},o=["google-analytics.com","googletagmanager.com","analytics.google.com","hotjar.com","mouseflow.com","clarity.ms","mixpanel.com","segment.com","amplitude.com","heap.io","fullstory.com","logrocket.com","quantcast.com","chartbeat.com","newrelic.com","pendo.io"],c=["facebook.net/fbevents","connect.facebook.net","doubleclick.net","ads.google.com","adservice.google.com","googleadservices.com","linkedin.com/px","snap.licdn.com","twitter.com/i/adsct","analytics.twitter.com","bat.bing.com","reddit.com/api/v2","pinterest.com/ct","tiktok.com/i18n/pixel","quora.com/qevents","taboola.com","outbrain.com","criteo.com","adroll.com","convertkit.com"];(window.gtag||window.ga||window.dataLayer&&!window.dataLayer._blocked)&&(e.googleAnalytics=!0),(window.google_tag_manager||document.querySelector('script[src*="googletagmanager.com/gtm.js"]'))&&(e.googleTagManager=!0),(window.fbq||window._fbq||document.querySelector('script[src*="facebook.net/fbevents"]'))&&(e.metaPixel=!0),(window.google?.maps||document.querySelector('script[src*="maps.googleapis.com"]'))&&(e.googleMaps=!0);return document.querySelectorAll("script[src]").forEach(t=>{const n=t.src.toLowerCase();o.forEach(o=>{if(n.includes(o)){const c=o.split(".")[0];e.otherAnalytics.includes(c)||e.otherAnalytics.push(c)}}),c.forEach(o=>{if(n.includes(o)){const c=o.split(".")[0];e.otherMarketing.includes(c)||e.otherMarketing.push(c)}})}),e}function p(){e&&(e.style.display="none",console.log("C.C. banner hidden"))}function b(){e&&(e.style.display="block",console.log("C.C. banner shown"))}function w(){o&&(o.style.display="block",console.log("Preferences popup shown"))}function f(){p(),o&&(o.style.display="none",console.log("Preferences popup hidden"))}function y(e){e.categories.analytics?(window.dataLayer&&"function"==typeof window.dataLayer.push&&!window.dataLayer._blocked||(window.dataLayer=window.dataLayer||[],delete window.dataLayer._blocked,console.log("✓ Google Analytics/GTM unblocked.")),window.gtag&&window.gtag._blocked&&(delete window.gtag._blocked,console.log("✓ gtag function unblocked."))):(window.dataLayer={push:function(){console.log("GTM/GA dataLayer push blocked.")},_blocked:!0},window.gtag=function(){},window.gtag._blocked=!0,console.log("✗ Google Analytics/GTM blocked.")),e.categories.marketing?window.fbq&&window.fbq._blocked&&(delete window.fbq._blocked,console.log("✓ Meta Pixel unblocked.")):(window.fbq=function(){},window.fbq._blocked=!0,window._fbq=window.fbq,console.log("✗ Meta Pixel blocked.")),e.categories.functional?window.initMap&&window.initMap._blocked&&(delete window.initMap._blocked,console.log("✓ Google Maps unblocked.")):(window.initMap=function(){console.log("Google Maps initialization blocked.")},window.initMap._blocked=!0,console.log("✗ Google Maps blocked."))}function k(){const e=JSON.parse(localStorage.getItem(g))||u;s&&(s.checked=e.categories.analytics),r&&(r.checked=e.categories.marketing),d&&(d.checked=e.categories.functional),console.log("Preferences UI populated with:",e)}c&&c.addEventListener("click",e=>{e.preventDefault();const o={status:"accepted",categories:{essential:!0,analytics:!0,marketing:!0,functional:!0}};localStorage.setItem(g,JSON.stringify(o)),f();const c=m();console.log("\n=== C.C.: ALL ACCEPTED ==="),console.log("Detected scripts:",c),console.log("Unblocking all categories..."),y(o),console.log("All marketing and analytics scripts have been unblocked."),console.log("====================================\n")}),t&&t.addEventListener("click",e=>{e.preventDefault();const o={status:"declined",categories:{essential:!0,analytics:!1,marketing:!1,functional:!1}};localStorage.setItem(g,JSON.stringify(o)),f();const c=m();console.log("\n=== C.C.: ALL DECLINED ==="),console.log("Detected scripts:",c),console.log("Blocking all categories..."),y(o),console.log("All marketing and analytics scripts have been blocked."),console.log("====================================\n")}),n&&n.addEventListener("click",e=>{e.preventDefault(),p(),k(),w()}),a&&a.addEventListener("click",e=>{e.preventDefault(),function(){const e={status:"custom",categories:{essential:!0,analytics:!!s&&s.checked,marketing:!!r&&r.checked,functional:!!d&&d.checked}};localStorage.setItem(g,JSON.stringify(e)),f();const o=m();console.log("\n=== C.C.: CUSTOM PREFERENCES ==="),console.log("Detected scripts:",o),console.log("Applying custom preferences:",e.categories),y(e),console.log("Custom cookie preferences have been applied."),console.log("==========================================\n")}()}),l&&l.addEventListener("click",e=>{e.preventDefault(),f();const o=JSON.parse(localStorage.getItem(g));o&&"pending"!==o.status||b()}),i&&i.addEventListener("click",e=>{e.preventDefault(),f(),k(),w()});const h=m();if(console.log("\n=== Calbie C.C. Banner Initialized ==="),console.log("Detected scripts on page:",h),S=h,!Object.values(S).some(e=>!0===e))return console.log("ℹ️  No marketing or analytics scripts detected on this page."),console.log("C.C. banner will not be shown."),console.log("================================================\n"),void f();var S;let v=JSON.parse(localStorage.getItem(g));v&&v.status?(v.categories={...u.categories,...v.categories||{}},f(),y(v),console.log("Existing consent loaded:",v),console.log("================================================\n")):(b(),localStorage.setItem(g,JSON.stringify(u)),console.log("No consent found, showing banner"),console.log("================================================\n"))});