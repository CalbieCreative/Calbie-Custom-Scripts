kdocument.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector('[data-calbie-cc="banner"]'),o=document.querySelector('[data-calbie-cc="preferences-popup"]'),c=document.querySelector('[data-calbie-cc="accept"]'),t=document.querySelector('[data-calbie-cc="decline"]'),n=document.querySelector('[data-calbie-cc="manage-preferences"]'),a=document.querySelector('[data-calbie-cc="save-preferences"]'),l=document.querySelector('[data-calbie-cc="close-preferences"]'),s=document.querySelector('[data-calbie-cc="open-settings"]'),i=document.querySelector('[data-calbie-cc-category="analytics"]'),r=document.querySelector('[data-calbie-cc-category="marketing"]');if(!e)return void console.error('C.C. banner element not found. Please add data-calbie-cc="banner" attribute to your banner div.');if(!c||!t)return void console.error("C.C. buttons not found. Please check your data-calbie-cc attributes.");const d="calbie_cc_preferences",g={status:"pending",categories:{essential:!0,analytics:!1,marketing:!1}};function u(){const e={googleAnalytics:!1,googleTagManager:!1,metaPixel:!1,googleMaps:!1,otherAnalytics:[],otherMarketing:[]},o=["google-analytics.com","googletagmanager.com","analytics.google.com","hotjar.com","mouseflow.com","clarity.ms","mixpanel.com","segment.com","amplitude.com","heap.io","fullstory.com","logrocket.com","quantcast.com","chartbeat.com","newrelic.com","pendo.io"],c=["facebook.net/fbevents","connect.facebook.net","doubleclick.net","ads.google.com","adservice.google.com","googleadservices.com","linkedin.com/px","snap.licdn.com","twitter.com/i/adsct","analytics.twitter.com","bat.bing.com","reddit.com/api/v2","pinterest.com/ct","tiktok.com/i18n/pixel","quora.com/qevents","taboola.com","outbrain.com","criteo.com","adroll.com","convertkit.com"];(window.gtag||window.ga||window.dataLayer&&!window.dataLayer._blocked)&&(e.googleAnalytics=!0),(window.google_tag_manager||document.querySelector('script[src*="googletagmanager.com/gtm.js"]'))&&(e.googleTagManager=!0),(window.fbq||window._fbq||document.querySelector('script[src*="facebook.net/fbevents"]'))&&(e.metaPixel=!0),(window.google?.maps||document.querySelector('script[src*="maps.googleapis.com"]'))&&(e.googleMaps=!0);return document.querySelectorAll("script[src]").forEach(t=>{const n=t.src.toLowerCase();o.forEach(o=>{if(n.includes(o)){const c=o.split(".")[0];e.otherAnalytics.includes(c)||e.otherAnalytics.push(c)}}),c.forEach(o=>{if(n.includes(o)){const c=o.split(".")[0];e.otherMarketing.includes(c)||e.otherMarketing.push(c)}})}),e}function m(){e&&(e.style.display="none",console.log("C.C. banner hidden"))}function p(){e&&(e.style.display="block",console.log("C.C. banner shown"))}function b(){o&&(o.style.display="block",console.log("Preferences popup shown"))}function w(){m(),o&&(o.style.display="none",console.log("Preferences popup hidden"))}function y(e){e.categories.analytics?(window.dataLayer&&"function"==typeof window.dataLayer.push&&!window.dataLayer._blocked||(window.dataLayer=window.dataLayer||[],delete window.dataLayer._blocked,console.log("✓ Google Analytics/GTM unblocked.")),window.gtag&&window.gtag._blocked&&(delete window.gtag._blocked,console.log("✓ gtag function unblocked."))):(window.dataLayer={push:function(){console.log("GTM/GA dataLayer push blocked.")},_blocked:!0},window.gtag=function(){},window.gtag._blocked=!0,console.log("✗ Google Analytics/GTM blocked.")),e.categories.marketing?window.fbq&&window.fbq._blocked&&(delete window.fbq._blocked,console.log("✓ Meta Pixel unblocked.")):(window.fbq=function(){},window.fbq._blocked=!0,window._fbq=window.fbq,console.log("✗ Meta Pixel blocked."))}function f(){const e=JSON.parse(localStorage.getItem(d))||g;i&&(i.checked=e.categories.analytics),r&&(r.checked=e.categories.marketing),console.log("Preferences UI populated with:",e)}c&&c.addEventListener("click",e=>{e.preventDefault();const o={status:"accepted",categories:{essential:!0,analytics:!0,marketing:!0}};localStorage.setItem(d,JSON.stringify(o)),w();const c=u();console.log("\n=== C.C.: ALL ACCEPTED ==="),console.log("Detected scripts:",c),console.log("Unblocking all categories..."),y(o),console.log("All marketing and analytics scripts have been unblocked."),console.log("====================================\n")}),t&&t.addEventListener("click",e=>{e.preventDefault();const o={status:"declined",categories:{essential:!0,analytics:!1,marketing:!1}};localStorage.setItem(d,JSON.stringify(o)),w();const c=u();console.log("\n=== C.C.: ALL DECLINED ==="),console.log("Detected scripts:",c),console.log("Blocking all categories..."),y(o),console.log("All marketing and analytics scripts have been blocked."),console.log("====================================\n")}),n&&n.addEventListener("click",e=>{e.preventDefault(),m(),f(),b()}),a&&a.addEventListener("click",e=>{e.preventDefault(),function(){const e={status:"custom",categories:{essential:!0,analytics:!!i&&i.checked,marketing:!!r&&r.checked}};localStorage.setItem(d,JSON.stringify(e)),w();const o=u();console.log("\n=== C.C.: CUSTOM PREFERENCES ==="),console.log("Detected scripts:",o),console.log("Applying custom preferences:",e.categories),y(e),console.log("Custom preferences have been applied."),console.log("==========================================\n")}()}),l&&l.addEventListener("click",e=>{e.preventDefault(),w();const o=JSON.parse(localStorage.getItem(d));o&&"pending"!==o.status||p()}),s&&s.addEventListener("click",e=>{e.preventDefault(),w(),f(),b()});const k=u();if(console.log("\n=== Calbie C.C. Banner Initialized ==="),console.log("Detected scripts on page:",k),h=k,!Object.values(h).some(e=>!0===e))return console.log("ℹ️  No marketing or analytics scripts detected on this page."),console.log("C.C. banner will not be shown."),console.log("================================================\n"),void w();var h;let v=JSON.parse(localStorage.getItem(d));v&&v.status?(v.categories={...g.categories,...v.categories||{}},w(),y(v),console.log("Existing consent loaded:",v),console.log("================================================\n")):(p(),localStorage.setItem(d,JSON.stringify(g)),console.log("No consent found, showing banner"),console.log("================================================\n"))});