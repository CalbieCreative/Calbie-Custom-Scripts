(()=>{document.addEventListener('DOMContentLoaded',()=>{const consentBanner=document.querySelector('[data-calbie-cc="banner"]');const acceptButton=document.querySelector('[data-calbie-cc="accept"]');const declineButton=document.querySelector('[data-calbie-cc="decline"]');const openSettingsLink=document.querySelector('[data-calbie-cc="open-settings"]');if(!consentBanner){console.error('Cookie consent banner element not found. Please add data-calbie-cc="banner" attribute to your banner div.');return;}if(!acceptButton||!declineButton){console.error('Cookie consent buttons not found. Please check your data-calbie-cc attributes.');return;}const CONSENT_KEY='calbie_cookie_consent_status';function loadScript(src,id,async=true,defer=true){if(document.getElementById(id))return;const script=document.createElement('script');script.src=src;script.id=id;script.async=async;script.defer=defer;document.head.appendChild(script);console.log(`Script loaded: ${src}`);}function hideBanner(){consentBanner.style.display='none';console.log('Cookie banner hidden');}function showBanner(){consentBanner.style.display='block';console.log('Cookie banner shown');}function loadEssentialScripts(){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());console.log('Google Analytics enabled.');!(function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments);};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s);})(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');console.log('Meta Pixel enabled.');console.log('All essential scripts loaded.');}function blockEssentialScripts(){window.dataLayer={push:function(){}};window.gtag=function(){};console.log('Google Analytics blocked.');window.fbq=function(){};window._fbq=window.fbq;console.log('Meta Pixel blocked.');window.initMap=function(){console.log('Google Maps initialization blocked.');};console.log('All non-essential scripts blocked.');}function manageScripts(status){if(status==='accepted'){loadEssentialScripts();}else{blockEssentialScripts();}}acceptButton.addEventListener('click',(e)=>{e.preventDefault();localStorage.setItem(CONSENT_KEY,'accepted');hideBanner();manageScripts('accepted');});declineButton.addEventListener('click',(e)=>{e.preventDefault();localStorage.setItem(CONSENT_KEY,'declined');hideBanner();manageScripts('declined');});if(openSettingsLink){openSettingsLink.addEventListener('click',(e)=>{e.preventDefault();showBanner();});}const currentConsent=localStorage.getItem(CONSENT_KEY);if(currentConsent){hideBanner();manageScripts(currentConsent);console.log(`Existing consent found: ${currentConsent}`);}else{showBanner();console.log('No consent found, showing banner');}function detectGTMId(){const gtmScript=document.querySelector('script[data-gtm-id]');if(gtmScript){return gtmScript.getAttribute('data-gtm-id');}const scripts=document.querySelectorAll('script[src*="googletagmanager.com/gtm.js"]');for(let script of scripts){const match=script.src.match(/id=(GTM-[A-Z0-9]+)/);if(match){return match[1];}}if(window.google_tag_manager){const gtmIds=Object.keys(window.google_tag_manager);if(gtmIds.length>0){return gtmIds[0];}}return null;}function loadGTM(gtmId){if(window.gtmLoaded||!gtmId)return;(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer',gtmId);window.gtmLoaded=true;console.log(`Google Tag Manager loaded with ID: ${gtmId}`);}function enableGTM(){const gtmId=detectGTMId();if(gtmId){if(window.google_tag_manager){window.dataLayer=window.dataLayer||[];console.log(`GTM already loaded (${gtmId}), dataLayer enabled.`);}else{loadGTM(gtmId);}}else{console.log('No GTM container detected on this site.');}}function blockGTM(){window.dataLayer={push:function(){console.log('GTM dataLayer push blocked due to consent preferences.');}};console.log('Google Tag Manager blocked.');}});})();